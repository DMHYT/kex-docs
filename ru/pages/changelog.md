# Список изменений в обновлениях мода Kernel Extension

## **RELEASE 5.0**

### ПОСЛЕДНЕЕ КРУПНОЕ ОБНОВЛЕНИЕ, РАЗРАБОТКА НОВЫХ ФИЧ ПРИОСТАНОВЛЕНА

### _**Нововведения:**_

- **Переработка API блокстейтов:**
  - Новый класс `BlockState`, содержащий методы, схожие с аналогичными в Forge
  - Модуль `BlockStates`, содержащий **функции для регистрации кастомных свойств блоков** и определения числовых энумов для некоторых ванильных свойств блоков
  - Модуль `VanillaStates`, содержащий все ванильные свойства блоков в виде объектов `Property`
  - `BlockState` InnerCore заменён на `BlockState` KEX везде, где использовался
  - Новый метод `BlocksModule.registerStateForBlock(id, property)`
  - Новые методы `BlockSource`: `getBlockState`, `setBlockState`, `setBlockStateNoUpdate`
- **Forge-подобные конфигурации модов** на основе адаптированной под Android библиотеки `night-config`, с этим планируется сделать больше
- Добавлены некоторые внутренние классы векторной математики в публичный API. См. модуль `KEX.Math` в документации. Впоследствии:
  - Новый метод `BlocksModule.registerComparatorSignalCallback` с калбек-функцией другого типа, использующей классы `BlockPos` и `Direction` вместо объекта `Callback.ItemUseCoordinates`
  - Новая перегрузка `BlockSource.getCustomBlockEntity` с `BlockPos` вместо трёх координат
  - Третий параметр `TileEntityCreationCallback`изменён с `Vector` на `BlockPos`
  - `BlockActor.getBlockPos` возвращает `BlockPos` вместо `Vector`
  - Новый метод `BlockActor.onNeighborChanged(blockPos)`
  - Третий параметр метода `BlockActor.onUse` изменён с `Vector` на `Vec3d`
- **Новый `KEX.BiomesModule`** с **методами получения свойств всех зарегистрированных биомов** и некоторыми новыми полезными фичами для кастомных биомов
  - Читабельные имена всех ванильных биомов на 23 языках (портировано с Java Edition)
  - `BiomesModule.setBiomeTranslationKey`: Кастомные ключи перевода для имён кастомных биомов
  - `BiomesModule.setModNameForBiome`: Укажите имя мода, добавляющего кастомный биом
  - Новые методы `BlockSource.getBiome` и `BlockSource.getBiomeFast`, позволяющие получить биом на любых координатах, даже если нужный чанк не прогружен
  - Добавлен калбек `BiomesInitialized`
- Добавлены параметры `attacker` и `victim` в метод `getAttackDamageBonus` объекта параметров кастомного инструмента

### _**Исправления багов и улучшения:**_

- Исправлен вылет метода `Actor.removeEffects`
- Исправлено неполное функционирование тултипа `ItemsModule`
- Исправлено 4 важных бага `ToolAPI`, большое спасибо [Nikujagajaga](https://github.com/Nikujagajaga) за сообщения обо всех проблемах и тестирование их фиксов с модом Tinker's Construct. `ToolAPI` KEX отныне можно считать корректно функционирующим на 99%.

## **RELEASE 4.0**

### _**Нововведения:**_

- **Java-система классов блоков и предметов, и их регистрация**
- Возможность создать новый файл `kex-config.json` в директории вашего мода и указать путь к директории ресурсов KEX относительно директории вашего мода
- Внутренние утилиты для парсинга JSON-моделей блоков и предметов из директорий ресурсов KEX в модах
- **API кастомных нативных BlockEntity для Java-разработчиков**: новый `TileEntityModule`, абстрактный Java-класс `BlockActor`, новый метод `KEX.BlockSource.getCustomBlockEntity`
- Новый **внутренний** `модуль фиксов`:
  - Восстановлена возможность создания кастомных типов звуков блоков и типов звуков мира в аддонах, сломанная самими же Mojang
- Новый `KEX.BlocksModule` с несколькими новыми возможностями для кастомных блоков:
  - `registerComparatorSignalCallback(blockID, callback, isCallbackForced?)` - регистрирует блок с данным ID как источник сигнала компаратора
  - `setLightEmission(id, data, lightLevel)` и `getLightEmission(id, data)` - позволяют указать отдельные значения уровня света для разных значений даты блока с одним и тем же ID
  - `registerOnStepOffCallback(blockID, callback)` - регистрирует функцию, которая будет вызываться когда сущность сходит с блока с данным ID
  - `registerOnStepOnCallback(blockID, callback)` - патч метода InnerCore `Block.registerEntityStepOnFunction`, который сломан по состоянию на `InnerCore 2.3.1b115`
  - **Все перечисленные методы имеют свои дубликаты в модуле InnerCore `Block`:**
    - `KEX.BlocksModule.registerComparatorSignalCallback` &rarr; `Block.registerComparatorSignalFunction`
    - `KEX.BlocksModule.[set/get]LightEmission` &rarr; `Block.[set/get]LightLevel`
    - `KEX.BlocksModule.registerOnStep[On/Off]Callback` &rarr; `Block.registerEntityStep[On/Off]Function`
- Нововведения в `KEX.LootModule`:
  - Методы `createLootTableModifier` и `addOnDropCallbackFor` теперь поддерживают полный путь к лут-тейблу, так же само как остальные методы модуля.
  - Добавлен метод `LootModifier.lock`, который позволяет предотвратить все последующие модификации определённого лут-тейбла
  - `registerCustomLootCondition[JS](conditionName, callback)` - добавляет новое условие лут-пула, которое вы можеет добавить в массив `"conditions"` в JSON-описании вашего лут-тейбла, и определить его абсолютно не ограниченное в возможностях поведение в вашем коде.
  - Новые лут-условия `"and"`, `"or"` и `"not"`
  - `runLootCondition(json, context)` - позволяет вам получить результат лут-условия по данному JSON-описанию для ваших собственных целей
- `AddonUtils.getNumericIdFromIdentifier` теперь может принимать строковой идентификатор **вместе с** префиксом `"minecraft:"`, автоматически отфильтровывая его внутренне.
- Добавлен метод `Mob.isSprinting`, который по ошибке не был добавлен ещё в далёком `RELEASE 1.0`
- Добавлен метод `Level.isClientSide`

### _**Исправления багов и улучшения:**_

- Обновлён тулчейн мода и зарефакторен ряд фрагментов кода, используя возможности Java 8
- Сделана крупная переработка в `AddonUtils`, теперь вы можете использовать `getNumericIdFromIdentifier` не после `"LevelDisplayed"`, а уже после `"ModsLoaded"`
- Исправлен крупный дефект в фиче тултипа предмета `ItemsModule`: aux-значение (дата) предмета ранее не использовалось для формирования ключа кеширования, так что вы могли видеть много случаев по типу гранита, андезита, диорита и т.д. под названием "Камень".

## **RELEASE 3.0**

### _**Нововведения:**_

- Добавлен метод `Actor.calculateAttackDamage`
- Добавлены нативные классы `TickingAreasManager` и `ActorDamageSource`
- Добавлен класс `KEX.BlockSource`, расширяющий `BlockSource` InnerCore и добавляющий некоторые новые методы, на данный момент их всего два: `getLevel()` и `getDimensionObject()`.
- Добавлены калбеки`EntitySneakChanged` и `ItemTooltip`
- Класс `ReachDistanceModifier` для изменения расстояния досягаемости игрока (максимальное расстояние, с которого игрок может дотянуться до блоков или мобов и взаимодействовать с ними).
- Класс `CameraRollModifier` для изменения угла наклона камеры игрока
- Добавлены методы нативного интерфейса `Dimension`: `getDimensionId()` и `getLevel()`.
- Добавлен метод `getTickingAreasManager()` нативного интерфейса `Level`.
- Добавлен класс `KEX.FoodItemComponent.Builder`
- Добавлен метод `KEX.GlobalContext.getLevel()`
- Добавлено несколько новых методов в класс `KEX.MobEffectInstance`
- Добавлены модули `TextureWorker` и `ItemAnimHelper` - последователи одноимённых библиотек
- Новые методы в модуле `Recipes` InnerCore:
  - `addSmithingTableRecipe(baseID, additionID, resultID)` - добавляет новый кастомный рецепт в столе кузнеца
  - `removeSmithingTableRecipe(baseID, additionID)` - удаляет рецепт в столе кузнеца по данным числовым ID двух ингредиентов, если рецепт с такими ингредиентами существует.
  - `getSmithingTableRecipesByResult(resultID)` - возвращает список всех зарегистрированных рецептов в столе кузнеца с предметом по данному числовому ID в качестве результата
  - `getSmithingTableRecipesByBase(baseID)` - возвращает список всех зарегистрированных рецептов в столе кузнеца с предметом по данному числовому ID в качестве первого ингредиента
  - `getAllSmithingTableRecipes()` - возвращает список абсолютно всех зарегистрированных рецептов в столе кузнеца, и ванильных, и кастомных
- Новые методы в `KEX.ItemsModule`:
  - `addTooltip(id, callback, priority?, isCallbackForced?)` - добавляет кастомную модификацию в описание предмета. Этот метод лучше чем `Item.registerNameOverrideFunction` в InnerCore, потому что модифицируется именно описание, а не имя предмета.
  - `setDynamicFoodValues(id, callback)` - устанавливает динамические значения еды для предмета по данному ID, зависящие от содержимого стака.
  - `registerReachDistanceModifierFor(id, modifier)` - делает так, чтобы данный объект `ReachDistanceModifier` активировался, когда игрок держит предмет с данным ID в руке.
- Новые методы в `KEX.LootModule`:
  - `fillContainer(world, x, y, z, tableName, actor)` - заполняет ванильный контейнер на данных координатах предметами, рандомно выбранными из данного лут-тейбла.
  - `getRandomItems(tableName, context)` - создаёт список рандомно выбранных из данного лут-тейбла предметов, используя данный объект обстоятельств лут-ивента, и возвращает его.
  - `forceLoad(tableName)` - принудительно загружает данный лут-тейбл в момент, когда игрок заходит в мир. Больше об этом читайте [здесь](https://dmhyt.github.io/kex-docs/api/modules/KEX.LootModule.html#forceLoad)
  - `registerCustomLootFunction[JS](functionName, callback)` - добавляет новую функцию предмета лут-тейбла, которую вы сможете добавить в массив `"functions"` в JSON-описании вашего лут-тейбла, и определить её абсолютно не ограниченное в возможностях поведение в вашем коде.
- Новый модуль `KEX.I18n` для получения и добавления ванильных локализаций.
- Новый модуль `KEX.ChunksModule` для работы с загруженными площадями в мире.
- Новый модуль `KEX.DamageModule` для регистрации новых источников урона и причин смерти сущностей, также содержащий новый метод для нанесения урона сущности, с более расширенным объектом параметров, чем в методе `Entity.damageEntity` в InnerCore.
- Новый модуль `KEX.CommandsModule` для регистрации кастомных команд в чате, и нововведения в модуле `Commands` InnerCore, содержащие альтернативное API для регистрации кастомных команд в чате, которое удобнее для разработки на JavaScript.
- Нововведения в энумы:
  - Заполнен энум `ETileEntityType` InnerCore, добавлено 29 недостающих числовых типов ванильных тайл-энтити.
  - Энум `KEX.EDamageCause`, перечисляющий все числовые ID причин урона сущностей, определённые в ванилле.
  - Энум `KEX.EArgumentType` для указания числовых типов агрументов команд в регистрации кастомных команд.

### _**Исправления багов:**_

- Удалена поддержка магического урона в калбеке `EntityHurt`, так как она вызывала несколько вызовов калбека за один ивент **обычного** урона.
- Исправлено **огромное** количество багов в патчах `ToolAPI`, огромное спасибо [Максиму Помазуеву](https://github.com/pomazuevmaksim) за тесты.
- Исправлены методы классов `Actor` и `Mob`, использующие объекты `ItemInstance` и `MobEffectInstance` в качестве аргументов.

## **BETA 2.2.3**

- Исправлены пользовательские параметры в объектах материалов инструментов, таким образом исправлен конфликт с модом `RedPowerPE`.
- Исправлено то, что ванильные инструменты не ломали блоки с правильной скоростью, вызвано это было модулем `VtableHelper` в модах `ProjectE` и `Item Information`.

## **BETA 2.2.2**

- Исправлено то, что кастомные инструменты не ломались
- Добавлен калбек `"ChangeCarriedItem"`

## **BETA 2.2.1**

- Исправлен вылет из-за кастомных инструментов на последнем обновлении пака InnerCore Test.
- Исправлен патч метода `ToolAPI.getDestroyTimeViaTool`.
- Ещё несколько исправлений обратной совместимости `ToolAPI`.

## **BETA 2.2**

- Добавлен метод `ItemsModule.setMaxUseDurationDynamic`.
- Заполнен энум `EItemAnimation` из InnerCore, добавлены поля `DRINK`, `BLOCK`, `CAMERA`, `SPEAR`, `CROSSBOW`.
- Исправлен конфликт с очень старыми версиями библиотеки `ToolLib` (протестировано с `ToolLib V14` в моде `Nocube's Wilderness`)
- Исправлен конфликт с модом `HarvestCraft`
- Добавлены новые типы инструментов в `ToolsModule` - ножницы и огниво
- Адаптирована одна внутренняя функция под будущую версию пака InnerCore

## **BETA 2.1**

- Полезные нововведения в модуле `Callback` (сделано [80LK](https://github.com/80LK))
  - `Callback.on(name, handler, priority?)` - аналог метода `Callback.addCallback`
  - `Callback.once(name, handler, priority?)` - то же самое, что `on`, но функция-обработчик события будет вызвана только один раз
  - `Callback.off(name, handler)` - удаляет данный обработчик события

## **BETA 2.0.4**

- Некоторые важные исправления в логике инструментов

## **BETA 2.0.3**

- Небольшое исправление в логике уровней инструментов

## **BETA 2.0.2**

- Исправлен вылет метода `Player.openSign`, а также он был переработан, так что теперь он открывает интерфейс таблички вместе с текстом, который уже был написан на табличке ранее.

## **BETA 2.0.1**

- Исправлены некоторые патчи методов `ToolAPI`, возвращающие Java-строки вместо JS-строк, улучшены TypeScript-декларации в плане строковых типов.

## **RELEASE 2.0**

- Теперь функция `ToolsModule.destroyBlockHook` полностью универсальная и может принимать любые JS-объекты с полями id и data, а не только объекты класса `FullBlock`.
- Небольшое исправление в логике насыщения еды.
- Добавлен энум `ESaturationModifier`.
- Добавлены нативные классы `Player`, `LocalPlayer`, `MoveInputHandler` и `LootTableContext`.
- Добавлен модуль `GlobalContext`, на данный момент содержащий только один метод - `getLocalPlayer()`.
- Добавлен модуль калбеков.
  - Первые новые калбеки - `PlayerJump` и `GameModeChanged`.
  - Предопределённый калбек `EntityHurt` теперь также вызывается при нанесении магического урона.
- Добавлены новые методы класса `Actor`:
  - `void removeEffects(boolean harmful, boolean harmless)`
  - `boolean isOnGround()`
  - Группа методов, связанных с компонентом дыхания
- Добавлен метод `LootModule.addOnDropCallbackFor` для модификации списка предметов каждый раз, когда они выбираются рандомно для того, чтобы выбросить их с моба или положить в сундук. Функциональный интерфейс калбека предоставляет вам сам список предметов, и объект `LootTableContext` для получения дополнительных данных о моменте смерти сущности / открытия сундука.

## **BETA 1.4**

- Исправлен патч метода создания еды
- API свойств еды.
  - Объект свойств еды может быть получен методом `ItemsModule.getFood(id)`, возвращает null если данный предмет не является едой.
  - Также есть метод `ItemsModule.isFood(id)` для проверки, является ли предмет едой или нет.
  - Добавлен метод `ItemsModule.newFoodSaturationModifier(name, value)` для регистрации кастомных строковых модификаторов насыщения еды, указываемых в JSON-компонентах. В ванилле есть только 6 предопределённых модификаторов: `poor`, `low`, `normal`, `good`, `max` and `supernatural`.
  - Добавлен метод `ItemsModule.saturationModifierFromString(name)`, который возвращает числовое значение модификатора насыщения, определённое по данному имени, или 1.2 если модификатора насыщения с данным именем не существует (1.2 - это значение модификатора `normal`).
- Добавлен метод `Actor.isElytraFlying()`.
- Исправлено то, что функция `destroyBlockHook` в `ToolsModule` не принимала `BlockState` в качестве объекта блока. Теперь эта функция и другие, использующие объекты блоков, универсальны для объектов `FullBlock` и `BlockState`.

## **BETA 1.3**

- Класс `AddonUtils` теперь экспортирован в публичном API.
- Добавлена функция `getKEXVersionCode()`, которая может быть использована для более удобных проверок версии.
- Добавлен калбек `"KEX-InnerCoreIdsCached"`, не передаёт параметров.
- Исправлен вылет методов `addJSModifyCallback` и `addJSPostModifyCallback` объекта `LootModifier`.

## **BETA 1.2**

- Добавлены методы класса `LootModifier`: `addJSModifyCallback`, `addJSONModifyCallback`, `addJSPostModifyCallback`, `addJSONPostModifyCallback`.
  - Первая пара используется для того, чтобы напрямую изменять JSON-объект лут-тейбла после всех программных модификаций.
  - Вторая пара используется для работы с JSON-объектом лут-тейбла после всех видов модификаций. В этих калбеках все передаваемые объекты - копии, и не следует их модифицировать.
- Добавлен метод `LootModule.addPiglinBarteringItem` для добавления новых предметов в список бартера с пиглинами. Этот метод не принимает параметров и возвращает интерфейс `LootEntry`.
- Добавлена функция `getKEXVersion()`, возвращает массив из трёх целых чисел текущей версии мода (сейчас это `[1, 2, 0]`).

## **BETA 1.1**

- Небольшой фикс в патче `Item.createFoodItem`
- Исправлены все ошибки, вызываемые логикой инструментов
- Реструктурирован и зарефакторен `LootModule`

## **RELEASE 1.0 (РАННЯЯ АЛЬФА)**

- Патч метода `Item.createFoodItem` для указания множества новых параметров (все перечислены в декларациях)
- Модуль `ToolAPI` полностью переписан на нативный код и ванильные классы инструментов. Вы всё ещё можете использовать `ToolAPI` для регистрации инструментов, но при этом для того, чтобы не заставлять KEX использовать небольшой костыль множество раз, рассмотрите возможность использования методов `ToolsModule.register[Sword/Axe/Pickaxe/Shovel/Hoe/CustomTool]` или `Item.create[([Sword/Axe/Pickaxe/Shovel/Hoe]Item)/CustomTool]` (вместо обычного `Item.createItem`).
  - Интерфейс `ToolAPI.ToolParams` теперь содержит новый метод `int getAttackDamageBonus(ItemInstance item)`, для изменения стандартного урона, применяемого к предмету в зависимости от содержимого стака (пример использования: `Наносабля` из `IC2`)
- `ItemsModule` с 8 новыми методами для предметов (в будущих обновлениях будет больше)
- `LootModule` для модификации ванильных лут-тейблов (сундуков в данжах, дропа с сущностей и лута с рыбалки, НЕ торговли).
- API для нативных классов `Actor`, `Mob`, `Slime`, `MobEffect` и `MobEffectInstance` (экспериментальное, не тестировалось)
